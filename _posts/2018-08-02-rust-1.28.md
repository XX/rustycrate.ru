---
layout: post
categories: новости
title: "Выпуск Rust 1.28"
author: The Rust Core Team
original: https://blog.rust-lang.org/2018/08/02/Rust-1.28.html
translator: XX
---

Команда разработчиков Rust рада сообщить о выпуске новой версии Rust: 1.28.0.
Rust - это системный язык программирования, нацеленный на безопасность, скорость
и параллельное выполнение кода.

Если у вас установлена предыдущая версия Rust с помощью rustup, то для обновления
Rust до версии 1.28.0 вам достаточно выполнить:

```bash
$ rustup update stable
```

Если у вас еще не установлен rustup, вы можете [установить его][install] с соответствующей
страницы нашего веб-сайта. С [подробными примечаниями к выпуску Rust 1.28.0][notes]
можно ознакомиться на GitHub.

[install]: https://www.rust-lang.org/install.html
[notes]: https://github.com/rust-lang/rust/blob/master/RELEASES.md#version-1280-2018-08-02

## Что вошло в стабильную версию 1.28.0

### Глобальные аллокаторы

С помощью аллокаторов программы на Rust получают память во время выполнения.
Раньше Rust не позволял изменять способ распределения памяти, что ограничивало
его использование в некоторых случаях. На одних платформах использовался
jemalloc, на других - системный аллокатор, но пользователи не могли это
контролировать. В выпуске 1.28.0 стабилизирован атрибут `#[global_allocator]`,
который позволяет программам на Rust устанавливать в качестве собственного
аллокатора системный аллокатор, а также определять новые аллокаторы, реализуя
типаж [`GlobalAlloc`].

Аллокатор по-умолчанию для Rust-программ на некоторых платформах - это jemalloc.
Стандартная библиотека теперь предоставляет дескриптор системного аллокатора,
который можно использовать для переключения на использование системного аллокатора,
когда это необходимо, путем статического объявления с атрибутом `#[global_allocator]`.

```rust
use std::alloc::System;

#[global_allocator]
static GLOBAL: System = System;

fn main() {
    let mut v = Vec::new();
    // Память будет распределяться с использованием системного аллокатора.
    v.push(1);
}
```

<!--cut-->

Однако, иногда вам требуется определить собственный аллокатор для специфической
функциональной области вашего приложения. Это тоже относительно легко сделать,
реализовав типаж `GlobalAlloc`. Подробнее о том, как это сделать, вы можете
прочитать в [документации].

[`GlobalAlloc`]: https://doc.rust-lang.org/stable/std/alloc/trait.GlobalAlloc.html
[documentation]: https://doc.rust-lang.org/stable/std/alloc/trait.GlobalAlloc.html

### Улучшено сообщение об ошибке форматирования

Работа по улучшению диагностики продолжается, на этот раз с акцентом
на форматирование:

```rust
format!("{_foo}", _foo = 6usize);
```

Раньше сообщение об ошибке в этом месте было довольно скудным:

```
error: invalid format string: expected `'}'`, found `'_'`
  |
2 |     format!("{_foo}", _foo = 6usize);
  |             ^^^^^^^^
```

Теперь новое диагностическое сообщение указывает конкретную причину, по
которой строка формата недействительна:

```
error: invalid format string: invalid argument name `_foo`
  |
2 |     let _ = format!("{_foo}", _foo = 6usize);
  |                       ^^^^ invalid argument name in format string
  |
  = note: argument names cannot start with an underscore
```

Подробности смотрите [в примечаниях к выпуску][notes].

### Стабилизация стандартной библиотеки

Кроме уже упомянутой стабилизации типажа `GlobalAlloc`, в этом выпуске
стабилизированы [`NonZero`] числовые типы. Это типы-обертки вокруг
стандартных беззнаковых целочисленных типов: `NonZeroU8`, `NonZeroU16`,
`NonZeroU32`, `NonZeroU64`, `NonZeroU128` и `NonZeroUsize`.

Они позволяют оптимизировать размер хранящихся данных. Например, `Option<u8>`
занимает два байта, тогда как `Option<NonZeroU8>` - один. Обратите внимание,
что эта оптимизация сохраняется даже тогда, когда `NonZeroU8` завернут внутрь
другой структуры; в примере ниже показано, что `Door` по-прежнему занимает
один байт, даже когда он помещен внутрь `Option`. Эта оптимизация применима
также и к перечислениям, определенным пользователем, `Option` тут не является
особенным.

```rust
use std::mem;
use std::num::NonZeroU8;

struct Key(NonZeroU8);

struct Door {
    key: Key,
}

fn main() {
    assert_eq!(mem::size_of::<Door>(), 1);
    assert_eq!(mem::size_of::<Option<Door>>(), 1);
}
```

Также было стабилизировано множество других компонентов библиотеки, полный список
которых вы найдете в подробных [примечаниях к выпуску][notes].

[`NonZero`]: https://doc.rust-lang.org/stable/std/num/index.html

### Улучшения в Cargo

[Карго теперь не позволит вам публиковать пакеты со скриптами сборки, которые
модифицируют каталог `src`.][cargo/5584] Каталог `src` в пакете следует считать
неизменяемым.

[cargo/5584]: https://github.com/rust-lang/cargo/pull/5584/

## Разработчики 1.28.0

Множество людей участвовало в разработке Rust 1.28. Мы не смогли бы
завершить работу без участия каждого из вас. [Спасибо!](https://thanks.rust-lang.org/rust/1.28.0)
